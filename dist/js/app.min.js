angular.module("waysApp",["ui.bootstrap","ngRoute","ngResource","waysApp.controllers","waysApp.directives","waysApp.services"]).config(function(a,b,c){c.html5Mode(!0),c.html5Mode(!0).hashPrefix("!"),a.when("/",{templateUrl:"Partials/map.html",controller:"mapController"}).when("/register",{templateUrl:"Partials/register.html",controller:"mapController"}).when("/admin",{templateUrl:"Partials/users.html",controller:"userController"}).when("/addcar",{templateUrl:"Partials/addcar.html"}).when("/adduser",{templateUrl:"Partials/adduser.html",controller:"mapController"}).when("/addorder",{templateUrl:"Partials/addorder.html",controller:"mapController"}).when("/adderror",{templateUrl:"Partials/adderror.html",controller:"mapController"}).when("/car/:id",{templateUrl:"Partials/car.html",controller:"carController"}).when("/faq",{templateUrl:"Partials/faq.html"}).when("/orderlist",{templateUrl:"Partials/orderlist.html",controller:"orderlistController"}).when("/list",{templateUrl:"Partials/list.html",controller:"listController"}).when("/statistics",{templateUrl:"Partials/statistics.html",controller:"listController"}).when("/errorlist",{templateUrl:"Partials/errorlist.html",controller:"errorListController"}).when("/error/:id",{templateUrl:"Partials/error.html",controller:"errorController"}),b.defaults.useXDomain=!0,delete b.defaults.headers.common["X-Requested-With"]}).constant("config",{appName:"waysfrontend",apiUrl:"https://42-ways.de:8443"}),angular.module("waysApp.controllers",[]).controller("MasterCtrl",function(a){a.getWidth=function(){return window.innerWidth},a.toggleSidebar=function(){a.toggle=!a.toggle},window.onresize=function(){a.$apply()}}).controller("mapController",function(a,b){b.getCars().then(function(b){a.currentQuery=b.data,a.vehicles=a.currentQuery.vehicles,a.green=0,a.yellow=0,a.red=0,a.totalVehicles=a.vehicles.length;for(var c=0;c<a.totalVehicles;c++)1==a.vehicles[c].status_id?a.green++:2==a.vehicles[c].status_id?a.yellow++:3==a.vehicles[c].status_id&&a.red++}),a.today=function(){a.dt=new Date(2016,1,1)},a.today()}).controller("carController",function(a,b,c){var d=b.id;c.getCar(d).then(function(b){a.currentQuery=b.data,a.entity=a.currentQuery.vehicles[0]}),c.getLiveData(d).then(function(b){a.ldresponse=b.data,null!=a.ldresponse.livedata&&(a.livedata=a.ldresponse.livedata,a.data=a.livedata.data)}),a.rep=function(){c.getVehicleReport(d).then(function(b){null!=b.data.report&&(a.report=b.data.report[0])})},a.rep()}).controller("listController",function(a,b){a.today=function(){a.dt=new Date(1970,1,1)},a.today(),b.getCars().then(function(b){a.currentQuery=b.data,a.vehicles=a.currentQuery.vehicles,a.green=0,a.yellow=0,a.red=0,a.totalVehicles=a.vehicles.length;for(var c=0;c<a.totalVehicles;c++)1==a.vehicles[c].status_id?a.green++:2==a.vehicles[c].status_id?a.yellow++:3==a.vehicles[c].status_id&&a.red++})}).controller("userController",function(a,b){b.getUsers().then(function(b){a.test=b.data,console.log(a.test),a.users=a.test.employees})}).controller("errorListController",function(a,b){b.getReports().then(function(b){a.currentQuery=b.data,a.errors=a.currentQuery.report,a.totalErrors=a.errors.length}),a.today=function(){a.dt=new Date(2016,1,1)},a.today()}).controller("errorController",function(a,b,c){var d=b.id;c.getReport(d).then(function(b){a.currentQuery=b.data,a.entity=a.currentQuery.report[0]})}),angular.module("waysApp.directives",[]).directive("map",function(a,b){return{restrict:"A",scope:{cars:"="},link:function(b){function c(){a.get("https://42-ways.de:8443/vehicle?vehicle_id=1").then(function(a){var b=a.data.vehicles,c=b[0].lastposition,e=c.latitude||50.9488,f=c.longitude||6.924,g=b[0].platenumber||"Unknown platenumber",h=(b[0].status_id||"test",b[0].buildyear||"test"),i=b[0].vehiclemodel,k=i.manufacturer||"test",l=i.model||"test",m='Kennzeichen: <a href="/car/'+b[0].vehicle_id+'">'+g+"</a><br>Hersteller: "+k+"<br>Model: "+l+"<br>Baujahr: "+h;x.setLatLng([e,f],{icon:d}).addTo(j).bindPopup(m)})}var d=L.icon({iconUrl:"img/Icons/car_green.png",shadowUrl:"img/Icons/shadow.png",iconSize:[96,64],shadowSize:[64,64],iconAnchor:[31,63],shadowAnchor:[32,40],popupAnchor:[1,-61]}),e=L.icon({iconUrl:"img/Icons/car_yellow.png",shadowUrl:"img/Icons/shadow.png",iconSize:[96,64],shadowSize:[64,64],iconAnchor:[31,63],shadowAnchor:[32,40],popupAnchor:[1,-61]}),f=L.icon({iconUrl:"img/Icons/car_red.png",shadowUrl:"img/Icons/shadow.png",iconSize:[96,64],shadowSize:[64,64],iconAnchor:[31,63],shadowAnchor:[32,40],popupAnchor:[1,-61]}),g=L.icon({iconUrl:"img/Icons/truck_green.png",shadowUrl:"img/Icons/shadow.png",iconSize:[96,64],shadowSize:[64,64],iconAnchor:[31,63],shadowAnchor:[32,40],popupAnchor:[1,-61]}),h=L.icon({iconUrl:"img/Icons/truck_yellow.png",shadowUrl:"img/Icons/shadow.png",iconSize:[96,64],shadowSize:[64,64],iconAnchor:[31,63],shadowAnchor:[32,40],popupAnchor:[1,-61]}),i=L.icon({iconUrl:"img/Icons/truck_red.png",shadowUrl:"img/Icons/shadow.png",iconSize:[96,64],shadowSize:[64,64],iconAnchor:[31,63],shadowAnchor:[32,40],popupAnchor:[1,-61]}),j=L.map("map").setView([50.935824,6.951172],13);if(L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(j),null!=b.cars){var k=b.cars.vehicles;if(k.length>1)for(var l=1;l<k.length;l++){var m=k[l].lastposition,n=m.latitude||50.9488,o=m.longitude||6.924,p=(m.time||24,k[l].platenumber||"Unknown platenumber"),q=k[l].status_id||"test",r=k[l].buildyear||"test",s=k[l].vehiclemodel,t=s.manufacturer||"test",u=s.model||"test",v=s["class"],w='Kennzeichen: <a href="/car/'+k[l].vehicle_id+'">'+p+"</a><br>Hersteller: "+t+"<br>Model: "+u+"<br>Baujahr: "+r;"PKW"==v?1==q?L.marker([n,o],{icon:d}).addTo(j).bindPopup(w):2==q?L.marker([n,o],{icon:e}).addTo(j).bindPopup(w):3==q&&L.marker([n,o],{icon:f}).addTo(j).bindPopup(w):1==q?L.marker([n,o],{icon:g}).addTo(j).bindPopup(w):2==q?L.marker([n,o],{icon:h}).addTo(j).bindPopup(w):3==q&&L.marker([n,o],{icon:i}).addTo(j).bindPopup(w)}else{var k=b.cars.vehicles,m=k[0].lastposition,n=m.latitude||50.9488,o=m.longitude||6.924,p=(m.time||24,k[0].platenumber||"Unknown platenumber"),q=k[0].status_id||"test",r=k[0].buildyear||"test",s=k[0].vehiclemodel,t=s.manufacturer||"test",u=s.model||"test",w='Kennzeichen: <a href="/car/'+k[0].vehicle_id+'">'+p+"</a><br>Hersteller: "+t+"<br>Model: "+u+"<br>Baujahr: "+r;1==q?L.marker([n,o],{icon:d}).addTo(j).bindPopup(w):2==q?L.marker([n,o],{icon:e}).addTo(j).bindPopup(w):3==q&&L.marker([n,o],{icon:f}).addTo(j).bindPopup(w),j.setView([n,o],15)}}else L.marker([50.9366,6.932303],{icon:f}).addTo(j).bindPopup('Kennzeichen: <a href="/car">K-O-7777</a><br>Hersteller: VW');var x=L.marker([0,0],{icon:d});c()}}}),angular.module("waysApp.services",[]).factory("queryService",function(a,b){return{getCars:function(){var c=b.get(a.apiUrl+"/vehicle");return c},getCar:function(c){return b.get(a.apiUrl+"/vehicle?vehicle_id="+c)},getReports:function(){return b.get(a.apiUrl+"/report")},getUsers:function(){return b.get(a.apiUrl+"/employee")},getReport:function(c){return b.get(a.apiUrl+"/report?vehicle_id="+c)},getVehicleReport:function(c){return b.get(a.apiUrl+"/report?vehicle_id="+c)},getLiveData:function(c){return b.get(a.apiUrl+"/latestlivedata/"+c)},getVehicleModels:function(){return b.get(a.apiUrl+"/vehiclemodels")},getOrders:function(a){return angular.fromJson('{ "vehicles": [ { "vehicle_id": 1, "vehiclemodel": { "model_id": 1, "model": "Model S", "manufacturer": "Tesla" }, "status_id": 1, "platenumber": "K-VB-1234", "buildyear": 2016, "lastposition": { "position_id": 2, "latitude": "50.099998", "longitude": "9.987656", "time": 1463600134 } } ] }')}}});